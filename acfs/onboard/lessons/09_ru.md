# RU: Multi-Repo Mastery

**Goal:** Sync dozens of repos with one command and automate commits with AI.

---

## Why RU Matters

Managing multiple repos manually is tedious:
- cd into each repo
- git pull
- Check for conflicts
- Repeat 20+ times

RU does this in seconds with parallel workers.

---

## Essential Commands

### Sync All Repos

```bash
# Basic sync (clone missing + pull updates)
ru sync

# Parallel sync with 4 workers (4x faster)
ru sync -j4

# Auto-stash local changes before pull
ru sync --autostash
```

### Check Status

```bash
# Quick status check
ru status

# Fetch remote + show ahead/behind counts
ru status --fetch
```

### Resume Interrupted Sync

```bash
# Continue from where you left off
ru sync --resume
```

---

## Agent Sweep: AI-Powered Commits

The killer feature. RU uses Claude to commit dirty repos intelligently.

### Preview First

Always preview before running:

```bash
ru agent-sweep --dry-run
```

This shows what would be committed without making changes.

### Run Agent Sweep

```bash
# Process repos sequentially
ru agent-sweep

# Process 4 repos in parallel
ru agent-sweep --parallel 4

# Include version bumps and tags
ru agent-sweep --with-release
```

### How It Works

1. **Understand**: Agent reads AGENTS.md, explores codebase
2. **Plan**: Agent produces JSON commit plan
3. **Execute**: RU executes validated plan with git commands

---

## Configuration

RU uses XDG conventions. Config lives in `~/.config/ru/`.

### Main Config

```bash
# ~/.config/ru/config
PROJECTS_DIR=/data/projects
PARALLEL=4
UPDATE_STRATEGY=ff-only
AUTOSTASH=false
```

### Repo Lists

```bash
# ~/.config/ru/repos.d/public.txt
Dicklesworthstone/ntm
Dicklesworthstone/beads_viewer
owner/repo@develop
owner/repo as my-fork
```

---

## Exit Codes

For scripting and automation:

| Code | Meaning |
|------|---------|
| 0 | Success |
| 1 | Partial failure (some repos failed) |
| 2 | Conflicts (manual resolution needed) |
| 5 | Interrupted (use --resume) |

---

## Quick Reference

| Command | What it does |
|---------|--------------|
| `ru sync` | Clone missing + pull all repos |
| `ru sync -j4` | Parallel sync with 4 workers |
| `ru status --fetch` | Check ahead/behind state |
| `ru agent-sweep --dry-run` | Preview AI commits |
| `ru agent-sweep --parallel 4` | Run AI commits |
| `ru doctor` | Health check installation |

---

## Integration with Other Tools

RU works best with the flywheel stack:

- **NTM**: Agent Sweep uses NTM robot mode
- **BV**: Track tasks across repos with beads
- **Mail**: Coordinate repo claims between agents

---

## Daily Workflow

A typical morning with RU:

```bash
# 1. Sync all repos (2 minutes for 20+ repos)
ru sync -j4

# 2. Check what needs attention
ru status --fetch

# 3. (Optional) Auto-commit dirty repos
ru agent-sweep --dry-run
ru agent-sweep --parallel 4
```

---

## Next

Learn about protecting yourself from dangerous commands with DCG:

```bash
onboard 10
```

---

*Tip: Run `ru sync -j4` right now to sync all your repos!*
